ä»¥ä¸‹ã¯**ãã®ã¾ã¾ã‚³ãƒ”ãƒšã§ Codex ã«æ¸¡ã™å‰æ**ã®ã€å®Ÿè£…ã‚¿ã‚¹ã‚¯æŒ‡ç¤ºæ›¸ã§ã™ã€‚
ç›®çš„ã¯ã€Œ**å¤–éƒ¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¾å­˜ã›ãš**ã€\*\*ã‚²ãƒ¼ãƒ å†…Excelï¼ˆLuminaçµŒç”±ã®ã‚·ãƒ¼ãƒˆï¼‰**ã ã‘ã§æ½œæ°´è‰¦ã‚»ã‚¯ã‚¿ãƒ¼ã‚’è§£æ±ºã—ã€å¿…è¦ãªã‚‰**ãƒ­ãƒ¼ã‚«ãƒ«JSONã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¡¨ï¼ˆA/B/â€¦ï¼‰\*\*ã§â€œæ–‡å­—â‡„é€šã—ç•ªå·â€ã‚’è£œå®Œã™ã‚‹ã€ä»•çµ„ã¿ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ã€‚
ï¼ˆDalamud ã§ã® Excel å–å¾—APIã¯ `IDataManager.GetExcelSheet<T>()`ã€‚ç½²åã¯å…¬å¼APIã«æ²è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚([Dalamud][1])ï¼Excelã®å®Ÿä½“ã¯FFXIVã®EXL/EXH/EXDãƒã‚¤ãƒŠãƒªã§ã€Luminaã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨xiv.devã§ä»•æ§˜åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚([Lumina][2], [XIV Dev][3])ï¼Lumina.Excel ã¯ã‚²ãƒ¼ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«è¿½éšã™ã‚‹è‡ªå‹•ç”Ÿæˆå®šç¾©ã§ã™ã€‚([NuGet][4])ï¼‰
**æ³¨**ï¼šã€ŒSubmarineExplorationã€ã‚·ãƒ¼ãƒˆã¯å¤–éƒ¨SDKã‚„XIVAPIã®ã‚·ãƒ¼ãƒˆåã§ã‚‚ç¢ºèªã§ãã¾ã™ã€‚([The Swift Package Index][5])

---

## âœ… ã‚¿ã‚¹ã‚¯æ¦‚è¦ï¼ˆCodexå‘ã‘ãƒ–ãƒªãƒ¼ãƒ•ï¼‰

**ãƒªãƒã‚¸ãƒˆãƒª**ï¼šæ—¢å­˜ Dalamud ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
**è¿½åŠ æ©Ÿèƒ½å**ï¼š`SubmarineSectorResolver`
**è¦ä»¶**ï¼š

1. `IDataManager`ï¼ˆ=Luminaï¼‰ã‹ã‚‰**ã‚²ãƒ¼ãƒ å†…Excelã® â€œSubmarineExplorationâ€** ã‚’èª­ã¿ã€
   `SectorId(RowId) / Name(åœ°ç‚¹å) / Map(æµ·åŸŸå)` ã‚’åˆ—æŒ™ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚([Dalamud][1])
2. æ–‡å­—ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆA, B, â€¦, AA, ABâ€¦ï¼‰ã¯**ãƒ­ãƒ¼ã‚«ãƒ«JSON**ã§è£œå®Œã€‚JSONãŒç„¡ã„/ä¸å®Œå…¨ã§ã‚‚**å£Šã‚Œãš**ã« `MapName + PlaceName` ã‚’è¡¨ç¤ºã§ãã‚‹ã€‚
3. `P18` ã®ã‚ˆã†ãªè¡¨è¨˜ã¯**å¤šç¾©çš„**ãªã®ã§ã€æ¬¡ã®é †ã§è§£æ±º:

   * **(a) æ•°å­—éƒ¨ã®ã¿ï¼ˆä¾‹: "18"ï¼‰**â†’ SectorId=18 ã‚’ç›´æ¥å¼•ãã€‚
   * **(b) æ–‡å­—+æ•°å­—ï¼ˆä¾‹: "P18"ï¼‰**â†’ `SectorId=18` ã‚’å„ªå…ˆè§£æ±ºã—ã€åŒæ™‚ã«\*\*æ–‡å­—ï¼ˆPï¼‰ã¨ã®ä¸ä¸€è‡´ãŒã‚ã‚Œã°â€œå‚è€ƒè¡¨ç¤ºâ€\*\*ã«ç•™ã‚ã‚‹ã€‚
   * **(c) æ–‡å­—ã®ã¿ï¼ˆä¾‹: "R"ï¼‰**â†’ **ãƒ­ãƒ¼ã‚«ãƒ«JSONã® `Map + Alias`** ã‹ã‚‰è©²å½“ã‚»ã‚¯ã‚¿ãƒ¼å€™è£œã‚’åˆ—æŒ™ï¼ˆæ›–æ˜§ãªã‚‰è¤‡æ•°æç¤ºï¼‰ã€‚
4. ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ `/sv test <code>` ã‚’è¿½åŠ ã€‚`"P18"` ã‚„ `"18"` ã‚’æ¸¡ã™ã¨ã€`Map / Alias / SectorId / PlaceName` ã‚’ãƒãƒ£ãƒƒãƒˆã«å‡ºåŠ›ã€‚
5. ï¼ˆä»»æ„ï¼‰è¨­å®šUIã«\*\*ã€Œãƒ­ãƒ¼ã‚«ãƒ«JSONã‚’å†èª­ã¿è¾¼ã¿ã€ã€ŒXIVAPIã‹ã‚‰JSONã‚’å†ç”Ÿæˆï¼ˆæ‰‹å‹•ï¼‰ã€**ãƒœã‚¿ãƒ³ã‚’ç½®ãã€‚XIVAPI v2ã¯**ã‚¹ã‚­ãƒ¼ãƒ&ãƒ‘ãƒƒãƒã‚’å›ºå®šã—ã¦å–å¾—å®‰å®šåŒ–\*\*ã§ãã‚‹ãŒã€**ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å¿…é ˆã§ã¯ãªã„**ï¼ˆæŠ¼ä¸‹æ™‚ã®ã¿HTTPï¼‰ã€‚([xivapi][6])

**å‚™è€ƒ**ï¼š

* ä¾‹ã¨ã—ã¦ **Concealed Bay ã¯ Deepâ€‘sea Site(æººæ²¡æµ·) ã® Alias=R**ã€‚([FFXIV Wiki][7], [Gamer Escape][8])
* ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è³‡æ–™ã§ã¯ **â€œSector 18 | R â€“ Concealed Bayâ€** ã®ä½µè¨˜ã‚‚ç¢ºèªã§ãã‚‹ï¼ˆå¤–éƒ¨è³‡æ–™ã¯â€œå‚è€ƒâ€æ‰±ã„ï¼‰ã€‚([Eorzea World][9])
* Mogshipã®è¨ˆç®—æ©ŸUIã‚‚ `R = Concealed Bay, S = Deepâ€‘sea Site 5, T = Purgatory â€¦` ã®ä¸¦ã³ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ï¼ˆå‚è€ƒï¼‰ã€‚([Mogship][10])

---

## ğŸ“ è¿½åŠ /å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

```
/Core/Sectors/SectorModels.cs
/Core/Sectors/AliasIndex.cs
/Core/Sectors/AliasIndex.json              // ãƒ­ãƒ¼ã‚«ãƒ«åŒæ¢±ã®ç¨®ãƒ‡ãƒ¼ã‚¿ï¼ˆä¸‹ã«ã‚µãƒ³ãƒ—ãƒ«ã‚ã‚Šï¼‰
/Core/Sectors/SectorResolver.cs
/Commands/SectorCommands.cs
/UI/SectorDebugWindow.cs                    // ä»»æ„ï¼ˆç°¡æ˜“UIï¼‰
```

---

## ğŸ§© å®Ÿè£…è©³ç´°

### 0) å‚ç…§ã¨åå‰ç©ºé–“ï¼ˆé‡è¦ï¼‰

* ç”Ÿæˆã‚·ãƒ¼ãƒˆå‹ã®åå‰ç©ºé–“ã¯ç’°å¢ƒã§ç•°ãªã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€**æ–°Lumina(7.x)ã® `Lumina.Excel.Sheets` ã‚’å„ªå…ˆ**ã€ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼æ™‚ã¯ **`Lumina.Excel.GeneratedSheets` ã«åˆ‡æ›¿**ã€‚
  ï¼ˆä¾‹ã§**ã‚¨ã‚¤ãƒªã‚¢ã‚¹ using**ã‚’ç”¨æ„ï¼‰

```csharp
// SectorModels.cs ã®å…ˆé ­ã‚ãŸã‚Š
using Dalamud.Plugin.Services;
using Lumina.Excel; // å‹ã¯ IDataManager.GetExcelSheet<T>() ã§è¿”ã‚‹ ExcelSheet<T> ã‚’åˆ©ç”¨ã€‚:contentReference[oaicite:9]{index=9}

// ç”Ÿæˆã‚·ãƒ¼ãƒˆã®åå‰ç©ºé–“ã¯ç’°å¢ƒå·®ãŒã‚ã‚‹ãŸã‚äºŒæŠã‚’ç”¨æ„ï¼ˆã©ã¡ã‚‰ã‹ç‰‡æ–¹ã ã‘æœ‰åŠ¹ã«ã™ã‚‹ï¼‰
#if USE_LUMINA_SHEETS_NS
using SubmarineExplorationRow = Lumina.Excel.Sheets.SubmarineExploration;   // æ–°ç³»
#else
using SubmarineExplorationRow = Lumina.Excel.GeneratedSheets.SubmarineExploration; // æ—§ç³»
#endif
```

> å‚ç…§æ ¹æ‹ ï¼š`IDataManager.GetExcelSheet<T>` ã®ç½²å/èª¬æ˜ï¼ˆDalamudå…¬å¼APIï¼‰ã€Luminaã®Excelä»•æ§˜ã€‚([Dalamud][1], [Lumina][11])

---

### 1) ãƒ¢ãƒ‡ãƒ«

```csharp
// Core/Sectors/SectorModels.cs
namespace Plugin.Core.Sectors;

public sealed class SectorEntry {
    public uint SectorId { get; init; }          // Excel RowId = ã‚»ã‚¯ã‚¿ãƒ¼é€šã—ç•ªå·ï¼ˆXIVAPIã®æ¦‚å¿µã§ã‚‚RowIdãŒä¸»ã‚­ãƒ¼ï¼‰:contentReference[oaicite:11]{index=11}
    public string PlaceName { get; init; } = ""; // åœ°ç‚¹è¡¨ç¤ºåï¼ˆä¾‹: "Concealed Bay"ï¼‰
    public string MapName { get; init; } = "";   // æµ·åŸŸï¼ˆä¾‹: "Deep-sea Site"ï¼‰
    public string? Alias { get; set; }           // æ–‡å­—ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆA..Z, AA..ï¼‰
}

public sealed class ResolveResult {
    public SectorEntry? Match { get; init; }
    public bool Ambiguous { get; init; }
    public IReadOnlyList<SectorEntry>? Candidates { get; init; }
    public string? Note { get; init; } // ä¾‹: "å…¥åŠ›ã® 'P' ã¨å®Ÿã‚¨ã‚¤ãƒªã‚¢ã‚¹ 'R' ãŒä¸ä¸€è‡´"
}
```

---

### 2) ãƒ­ãƒ¼ã‚«ãƒ«JSONã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¡¨ï¼ˆèª­ã¿æ›¸ãï¼‰

```csharp
// Core/Sectors/AliasIndex.cs
using System.Text.Json;

namespace Plugin.Core.Sectors;

public sealed class AliasIndex {
    // MapName -> (Alias -> SectorId)
    public Dictionary<string, Dictionary<string, uint>> MapAliasToSector { get; init; } = new(StringComparer.OrdinalIgnoreCase);

    public static AliasIndex LoadOrDefault(string jsonPath) {
        if (File.Exists(jsonPath)) {
            var json = File.ReadAllText(jsonPath);
            var data = JsonSerializer.Deserialize<AliasIndex>(json) ?? new AliasIndex();
            Normalise(data);
            return data;
        }
        var d = new AliasIndex();
        Normalise(d);
        return d;
    }

    public void Save(string jsonPath) {
        var json = JsonSerializer.Serialize(this, new JsonSerializerOptions { WriteIndented = true });
        File.WriteAllText(jsonPath, json);
    }

    private static void Normalise(AliasIndex d) {
        foreach (var (map, table) in d.MapAliasToSector.ToArray()) {
            d.MapAliasToSector[map] = new Dictionary<string, uint>(table, StringComparer.OrdinalIgnoreCase);
        }
    }
}
```

**`AliasIndex.json` ã®â€œç¨®ãƒ‡ãƒ¼ã‚¿â€ã‚µãƒ³ãƒ—ãƒ«**ï¼ˆ**æœ€ä½é™**ï¼šæººæ²¡æµ·ã® A..AD ã®ä¸¦ã³ã ã‘å…¥ã‚Œã¦ãŠãã€‚*A=1â€¦Z=26, AA=27, AB=28, AC=29, AD=30*ï¼‰
â€»ã“ã‚Œã¯**äººåŠ›ã§ä½œã£ã¦ã‚ˆã„**ï¼**å¾Œè¿°ã®UI/ãƒœã‚¿ãƒ³ã§æ›´æ–°**ã€‚Mogship/GE/CGWã§è£å–ã‚Šå¯èƒ½ï¼ˆå‚è€ƒï¼‰ã€‚([Mogship][10], [Gamer Escape][12], [Console Games Wiki][13])

```json
{
  "MapAliasToSector": {
    "Deep-sea Site": {
      "A": 1, "B": 2, "C": 3, "D": 4, "E": 5, "F": 6, "G": 7, "H": 8, "I": 9, "J": 10,
      "K": 11, "L": 12, "M": 13, "N": 14, "O": 15, "P": 16, "Q": 17, "R": 18, "S": 19, "T": 20,
      "U": 21, "V": 22, "W": 23, "X": 24, "Y": 25, "Z": 26,
      "AA": 27, "AB": 28, "AC": 29, "AD": 30
    }
  }
}
```

> å‚è€ƒï¼š**Concealed Bay = Alias R / Map Deepâ€‘sea Site**ã€‚Râ†’18 ã®æ•´åˆã¯å¤–éƒ¨è³‡æ–™ã§ã‚‚ç›®è¦–ç¢ºèªã§ãã‚‹ï¼ˆå‚è€ƒï¼‰ã€‚([FFXIV Wiki][7], [Eorzea World][9])

---

### 3) Excel ã‹ã‚‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆï¼ˆå”¯ä¸€ã®ã‚½ãƒ¼ã‚¹ï¼‰

```csharp
// Core/Sectors/SectorResolver.cs
using Dalamud.Plugin.Services;
using Lumina.Excel;
using System.Text.RegularExpressions;

namespace Plugin.Core.Sectors;

public sealed class SectorResolver {
    private readonly Dictionary<uint, SectorEntry> byId = new();
    private readonly Dictionary<(string map, uint id), SectorEntry> byMapAndId = new();
    private readonly Dictionary<(string map, string alias), SectorEntry> byAlias = new();
    private readonly AliasIndex aliasIndex;
    private static readonly Regex CodeRx = new(@"^(?<letters>[A-Z]{1,2})?(?<digits>\d+)?$", RegexOptions.Compiled);

    public SectorResolver(IDataManager data, AliasIndex aliasIndex) {
        this.aliasIndex = aliasIndex;

        // Excel ã‹ã‚‰ SubmarineExploration ã‚’åˆ—æŒ™
        var sheet = data.GetExcelSheet<SubmarineExplorationRow>(); // Excelã®å–å¾—APIã€‚:contentReference[oaicite:14]{index=14}
        foreach (var row in sheet) {
            var id = row.RowId;                       // RowId ã¯å„ã‚·ãƒ¼ãƒˆã®ä¸»ã‚­ãƒ¼ï¼ˆXIVAPIã®æ¦‚å¿µã¨ã‚‚ä¸€è‡´ï¼‰ã€‚:contentReference[oaicite:15]{index=15}
            var name = row.Name?.ToString() ?? "";    // ç”Ÿæˆå‹ã®åˆ—åã¯ç’°å¢ƒå·®ã‚ã‚Šã€‚Name/PlaceName ç­‰ã„ãšã‚Œã‹ã§å–å¾—
            var map  = GetMapName(row);               // ä¸‹ã®è£œåŠ©é–¢æ•°ã§ãƒãƒƒãƒ—åã‚’å–ã‚Šå‡ºã™
            var entry = new SectorEntry { SectorId = id, PlaceName = name, MapName = map };
            byId[id] = entry;
            byMapAndId[(map, id)] = entry;
        }

        // JSON ã® Alias ã‚’ç´ä»˜ã‘ï¼ˆä»»æ„/å­˜åœ¨ã™ã‚‹åˆ†ã ã‘ï¼‰
        foreach (var (map, table) in aliasIndex.MapAliasToSector) {
            foreach (var (alias, sectorId) in table) {
                if (byMapAndId.TryGetValue((map, sectorId), out var e)) {
                    e.Alias = alias.ToUpperInvariant();
                    byAlias[(map, e.Alias)] = e;
                }
            }
        }
    }

    public SectorEntry? FromSectorId(uint id) => byId.GetValueOrDefault(id);

    public SectorEntry? FromAlias(string map, string alias) =>
        byAlias.TryGetValue((map, alias.ToUpperInvariant()), out var e) ? e : null;

    /// <summary> "P18" / "18" / "R" ã‚’è§£æ±ºã€‚æ›–æ˜§æ™‚ã¯ Candidates ã‚’è¿”ã™ã€‚ </summary>
    public ResolveResult ResolveCode(string code, string? mapHint = null) {
        var m = CodeRx.Match(code.Trim().ToUpperInvariant());
        if (!m.Success) return new ResolveResult { Ambiguous = true, Note = "ã‚³ãƒ¼ãƒ‰å½¢å¼ä¸æ­£" };

        var letters = m.Groups["letters"].Success ? m.Groups["letters"].Value : null;
        var digitsStr = m.Groups["digits"].Success ? m.Groups["digits"].Value : null;

        // (1) digits ã‚’æœ€å„ªå…ˆï¼ˆ"18" or "P18" ã® "18"ï¼‰
        if (uint.TryParse(digitsStr, out var id)) {
            var byIdHit = FromSectorId(id);
            if (byIdHit != null) {
                // æ–‡å­—ãŒä¸ãˆã‚‰ã‚Œã¦ã„ã¦ä¸ä¸€è‡´ãªã‚‰æ³¨è¨˜
                string? note = null;
                if (!string.IsNullOrEmpty(letters) && !string.Equals(byIdHit.Alias, letters, StringComparison.OrdinalIgnoreCase)) {
                    note = $"å…¥åŠ›ã®åˆ¥å '{letters}' ã¨å®Ÿãƒ‡ãƒ¼ã‚¿ã®åˆ¥å '{byIdHit.Alias ?? "æœªå®šç¾©"}' ãŒä¸ä¸€è‡´";
                }
                return new ResolveResult { Match = byIdHit, Note = note };
            }
        }

        // (2) letters ã®ã¿ã§è§£æ±ºï¼ˆMapãƒ’ãƒ³ãƒˆãŒç„¡ã‘ã‚Œã°å…¨Mapã‚’èµ°æŸ»ï¼‰
        if (!string.IsNullOrEmpty(letters)) {
            if (!string.IsNullOrEmpty(mapHint)) {
                var byAliasHit = FromAlias(mapHint, letters);
                if (byAliasHit != null) return new ResolveResult { Match = byAliasHit };
                return new ResolveResult { Ambiguous = true, Note = $"'{mapHint}' ã«åˆ¥å {letters} ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" };
            }
            // å…¨Mapæ¢ç´¢ï¼ˆè¤‡æ•°å€™è£œã‚’è¿”ã™ï¼‰
            var cands = byId.Values.Where(e => string.Equals(e.Alias, letters, StringComparison.OrdinalIgnoreCase)).ToList();
            return cands.Count == 1
                ? new ResolveResult { Match = cands[0] }
                : new ResolveResult { Ambiguous = true, Candidates = cands, Note = "è¤‡æ•°ã®æµ·åŸŸã§åŒã˜åˆ¥åãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ" };
        }

        // (3) ã©ã¡ã‚‰ã‚‚ç„¡ã‘ã‚Œã°æ›–æ˜§
        return new ResolveResult { Ambiguous = true, Note = "è§£æ±ºã«å¿…è¦ãªæƒ…å ±ãŒä¸è¶³" };
    }

    private static string GetMapName(SubmarineExplorationRow row) {
        // ç”Ÿæˆå‹ã®åˆ—åã¯ç’°å¢ƒå·®ãŒã‚ã‚‹ãŸã‚ã€å€™è£œã‚’é †ã«è©¦ã™
        // ä¾‹: row.Map?.Value?.Name?.ToString() / row.Map?.ToString() / row.PlaceName* ç³»
        var map = row.GetType().GetProperty("Map")?.GetValue(row);
        if (map != null) {
            // LazyRow<PlaceName> ã®å¯èƒ½æ€§ã‚’è€ƒæ…®
            var valProp = map.GetType().GetProperty("Value");
            var value = valProp?.GetValue(map);
            var nameProp = value?.GetType().GetProperty("Name");
            var name = nameProp?.GetValue(value)?.ToString();
            if (!string.IsNullOrEmpty(name)) return name!;
        }
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç„¡åï¼‰
        return "Unknown Map";
    }
}
```

---

### 4) ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

```csharp
// Commands/SectorCommands.cs
using Dalamud.Game.Command;
using Dalamud.Plugin;
using Dalamud.Plugin.Services;
using Plugin.Core.Sectors;

namespace Plugin.Commands;

public sealed class SectorCommands : IDisposable {
    private readonly IDalamudPluginInterface pi;
    private readonly ICommandManager cmds;
    private readonly SectorResolver resolver;

    private const string Cmd = "/sv";

    public SectorCommands(IDalamudPluginInterface pi, ICommandManager cmds, SectorResolver resolver) {
        this.pi = pi; this.cmds = cmds; this.resolver = resolver;
        cmds.AddHandler(Cmd, new CommandInfo(OnCmd) {
            HelpMessage = "/sv test <code> ä¾‹: /sv test P18"
        });
    }

    public void Dispose() => cmds.RemoveHandler(Cmd);

    private void OnCmd(string cmd, string args) {
        var parts = args.Split(' ', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
        if (parts.Length >= 2 && parts[0].Equals("test", StringComparison.OrdinalIgnoreCase)) {
            var code = parts[1];
            var res = resolver.ResolveCode(code);
            if (res.Match != null) {
                var m = res.Match;
                Chat($"[{code}] => Map={m.MapName}, Alias={m.Alias ?? "-"}, SectorId={m.SectorId}, Name={m.PlaceName}{(string.IsNullOrEmpty(res.Note) ? "" : $" ({res.Note})")}");
            } else if (res.Ambiguous && res.Candidates is { Count: >0 }) {
                Chat($"[{code}] ã¯æ›–æ˜§ã€‚å€™è£œ: " + string.Join(" | ", res.Candidates.Select(c => $"{c.MapName}:{c.Alias}/{c.SectorId}:{c.PlaceName}")));
            } else {
                Chat($"[{code}] ã¯è§£æ±ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚{res.Note}");
            }
            return;
        }
        Chat("ä½¿ã„æ–¹: /sv test <code> ä¾‹: /sv test P18");
    }

    private void Chat(string msg) => pi.UiBuilder.AddNotification(msg, "SubmarineSectorResolver", Dalamud.Interface.Internal.Notifications.NotificationType.Info);
}
```

---

### 5) ç°¡æ˜“UIï¼ˆä»»æ„ï¼‰

```csharp
// UI/SectorDebugWindow.cs
using Dalamud.Interface.Windowing;
using ImGuiNET;
using Plugin.Core.Sectors;

namespace Plugin.UI;

public sealed class SectorDebugWindow : Window {
    private readonly SectorResolver resolver;
    private string input = "P18";

    public SectorDebugWindow(SectorResolver resolver) : base("Sector Debug") {
        this.resolver = resolver;
        Size = new System.Numerics.Vector2(420, 240);
        SizeCondition = ImGuiCond.FirstUseEver;
    }

    public override void Draw() {
        ImGui.InputText("Code", ref input, 32);
        if (ImGui.Button("Resolve")) {
            var r = resolver.ResolveCode(input);
            if (r.Match != null) {
                var m = r.Match;
                ImGui.TextWrapped($"Map={m.MapName}, Alias={m.Alias ?? "-"}, SectorId={m.SectorId}, Name={m.PlaceName}");
                if (!string.IsNullOrEmpty(r.Note)) ImGui.TextColored(new(1, .8f, .2f, 1), r.Note);
            } else if (r.Ambiguous && r.Candidates is { Count: > 0 }) {
                ImGui.Text("Ambiguous:");
                foreach (var c in r.Candidates) ImGui.BulletText($"{c.MapName}:{c.Alias}/{c.SectorId}:{c.PlaceName}");
            } else ImGui.TextColored(new(1, .4f, .4f, 1), r.Note ?? "Failed");
        }
    }
}
```

---

### 6) æ—¢å­˜ `Plugin.cs` ã¸ã®çµ„ã¿è¾¼ã¿ï¼ˆæ¦‚ç•¥ï¼‰

```csharp
// Plugin.csï¼ˆæ¦‚ç•¥ï¼‰
using Dalamud.Plugin;
using Dalamud.Plugin.Services;
using Plugin.Commands;
using Plugin.Core.Sectors;
using Plugin.UI;

public sealed class Plugin : IDalamudPlugin {
    public string Name => "YourPlugin";

    public Plugin(
        IDalamudPluginInterface pi,
        IDataManager data,
        ICommandManager cmds
    ) {
        var aliasPath = Path.Combine(pi.ConfigDirectory.FullName, "AliasIndex.json");
        var aliasIndex = AliasIndex.LoadOrDefault(aliasPath);
        var resolver = new SectorResolver(data, aliasIndex);

        // Commands
        _commands = new SectorCommands(pi, cmds, resolver);

        // ï¼ˆä»»æ„ï¼‰UI
        _window = new SectorDebugWindow(resolver);
        pi.UiBuilder.Draw += _window.Draw;
    }

    private readonly SectorCommands _commands;
    private readonly SectorDebugWindow _window;

    public void Dispose() { /* â€¦ */ }
}
```

---

## ğŸ” ä»»æ„ï¼šãƒ­ãƒ¼ã‚«ãƒ«JSONã®æ›´æ–°ãƒœã‚¿ãƒ³ï¼ˆXIVAPI v2ï¼‰

* è¨­å®šUIã«ã€Œ**ã‚¨ã‚¤ãƒªã‚¢ã‚¹JSONå†ç”Ÿæˆ**ã€ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã€æŠ¼ã•ã‚ŒãŸæ™‚ã ã‘ `HttpClient` ã§ XIVAPI v2 ã‚’å©ã„ã¦ `SubmarineExploration` ã‚’å–å¾— â†’ `RowId / Map / Name` ã‚’èª­ã‚“ã§**äººåŠ›ã§ä»˜ã‘ãŸ Alias ã‚’æ¤œè¨¼ or è¿½è¨˜**ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã—ã¦ã‚‚è‰¯ã„ã§ã™ã€‚
* XIVAPI v2 ã¯**ã‚¹ã‚­ãƒ¼ãƒï¼ãƒ‘ãƒƒãƒã®ãƒ”ãƒ³å›ºå®š**ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€\*\*å¸¸ç”¨ã§ã¯ãªãâ€œæŠ¼ã—ãŸæ™‚ã ã‘â€\*\*ã§ã‚‚ååˆ†å®‰å…¨ã«æ›´æ–°ã§ãã¾ã™ï¼ˆâ€œå®‰å®šæ€§ãƒ»ãƒ”ãƒ³å›ºå®šâ€ã¯å…¬å¼Docã«æ˜è¨˜ï¼‰ã€‚([xivapi][6])
* ãªãŠã€**ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä¾å­˜ã«ã—ãªã„**ï¼ˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã•ãªã„é™ã‚Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æœªä½¿ç”¨ï¼‰è¨­è¨ˆã«ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ§ª å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆAcceptance Criteriaï¼‰

1. `/sv test 18` â†’ `SectorId=18` ã®è¡ŒãŒè§£æ±ºã•ã‚Œã€`MapName=Deepâ€‘sea Site, Alias=Rï¼ˆJSONãŒã‚ã‚‹å ´åˆï¼‰, PlaceName=Concealed Bay` ç­‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
   ï¼ˆ**å‚è€ƒ**ï¼šConcealed Bay = Alias R / Map Deepâ€‘sea Siteã€‚([FFXIV Wiki][7])ï¼‰
2. `/sv test P18` â†’ `SectorId=18` ãŒè¦‹ã¤ã‹ã‚‹ã€‚å…¥åŠ›ã® `P` ã¨å®Ÿã‚¨ã‚¤ãƒªã‚¢ã‚¹ `R` ãŒä¸ä¸€è‡´ãªã‚‰**æ³¨è¨˜**ãŒä»˜ãã€‚
3. `/sv test R` â†’ **Deepâ€‘sea Site ã® R(=18)** ãŒãƒ’ãƒƒãƒˆã™ã‚‹ï¼ˆJSONã«å‰æ²ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’å…¥ã‚Œã¦ã„ã‚‹å‰æï¼‰ã€‚
4. `AliasIndex.json` ã‚’å‰Šé™¤ã—ã¦ã‚‚ã€**å°‘ãªãã¨ã‚‚ `MapName + PlaceName` ã®è¡¨ç¤ºã¯æˆåŠŸ**ã—ã€è½ã¡ãªã„ã€‚
5. ï¼ˆä»»æ„ï¼‰è¨­å®šUIã®ã€Œå†èª­ã¿è¾¼ã¿ã€ã§ JSON ã‚’å†èª­è¾¼ã§ãã‚‹ã€‚
6. ï¼ˆä»»æ„ï¼‰ã€ŒJSONå†ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã¯æŠ¼ä¸‹æ™‚ã®ã¿HTTPã‚¢ã‚¯ã‚»ã‚¹ã—ã€**æŠ¼ã•ãªã„é™ã‚Šå®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³**ã€‚

---

## ğŸ“š å‚è€ƒæ ¹æ‹ ï¼ˆå®Ÿè£…åˆ¤æ–­ã«é–¢ã‚ã‚‹è¦ç‚¹ï¼‰

* **Dalamud API**ï¼š`IDataManager.GetExcelSheet<T>()` ã§ã‚²ãƒ¼ãƒ å†…ã‚·ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆç½²å/è§£èª¬ï¼‰ã€‚([Dalamud][1])
* **Lumina**ï¼šã‚²ãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Excelï¼ˆEXD/EXHï¼‰ã‚’èª­ã‚€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚åŸºæœ¬/Excelã®è©³ç´°ã¯å…¬å¼Docsã«è¨˜è¼‰ã€‚([Lumina][2])
* **Excelï¼ˆEXL/EXH/EXDï¼‰ä»•æ§˜**ï¼šxiv.dev ã®èª¬æ˜ã€‚([XIV Dev][3])
* **`SubmarineExploration` ã‚·ãƒ¼ãƒˆå**ï¼šå¤–éƒ¨SDKï¼ˆxivapi-swiftï¼‰ã®ã‚·ãƒ¼ãƒˆä¸€è¦§ã«å­˜åœ¨ã€‚([The Swift Package Index][5])
* **RowId ãŒä¸»ã‚­ãƒ¼**ï¼šXIVAPI v2 ã®ã€ŒImportant Conceptsã€ã€‚([xivapi][14])
* **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è£å–ã‚Š**ï¼ˆè¡¨ç¤ºä¸Šã®Alias/Mapã®çµ„ï¼‰

  * GamerEscape/ConsoleGamesWikiï¼šä¾‹ã€ŒConcealed Bay = Alias R / Map Deepâ€‘sea Siteã€ã€‚([Gamer Escape][8], [FFXIV Wiki][7])
  * Mogshipï¼ˆTrip Plannerã®ãƒ©ãƒ™ãƒ«ï¼‰ï¼šR=Concealed Bay, S=Deepâ€‘sea Site 5, T=Purgatory â€¦ã€‚([Mogship][10])
* **XIVAPI v2**ï¼ˆå®‰å®šåŒ–ãƒ»ãƒ”ãƒ³å›ºå®šãƒ»å…¨ã‚·ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹ï¼‰ï¼šå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚([xivapi][6])
* **Lumina.Excel ã®è‡ªå‹•ç”Ÿæˆå®šç¾©ã¯ã‚²ãƒ¼ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«è¿½éš**ï¼šNuGet èª¬æ˜ã€‚([NuGet][4])

---

### ãƒ¡ãƒ¢ï¼ˆCodexå®Ÿè£…ä¸Šã®æ³¨æ„ï¼‰

* `SubmarineExplorationRow` ã®åˆ—åã¯ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã§è‹¥å¹²å·®ãŒã‚ã‚Šã¾ã™ï¼ˆ`Name` / `PlaceName` / `Map` ãªã©ï¼‰ã€‚ä¸Šã® `GetMapName` ã§ã¯**åå°„**ã§å¯èƒ½ãªé™ã‚Šæ‹¾ã†ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚
* JSON ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯**å¾Œã‹ã‚‰äººåŠ›ã§è¶³ã—ã¦ã‚‚OK**ã€‚**ç„¡ãã¦ã‚‚å‹•ã**è¨­è¨ˆãŒä¸»çœ¼ã§ã™ã€‚
* å¤–éƒ¨ã‚µã‚¤ãƒˆã®å¯¾å¿œè¡¨ã¯ã€Œ**ç›®è¦–æ¤œè¨¼ã®å‚è€ƒ**ã€ã€‚\*\*ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚½ãƒ¼ã‚¹ãƒ»ã‚ªãƒ–ãƒ»ãƒˆã‚¥ãƒ«ãƒ¼ã‚¹ã¯å¸¸ã« Excelï¼ˆ=ã‚²ãƒ¼ãƒ å†…ãƒ‡ãƒ¼ã‚¿ï¼‰\*\*ã§ã™ã€‚

ä»¥ä¸Šã€‚

[1]: https://dalamud.dev/api/Dalamud.Plugin.Services/Interfaces/IDataManager/ "Interface IDataManager | Dalamud"
[2]: https://lumina.xiv.dev/docs/guides/basic-usage.html "Setup & Basic Usage "
[3]: https://xiv.dev/game-data/file-formats/excel "Excel | XIV Dev Wiki"
[4]: https://www.nuget.org/packages/Lumina.Excel "
        NuGet Gallery
        \| Lumina.Excel 7.3.1
    "
[5]: https://swiftpackageindex.com/eisenhuth/xivapi-swift/v0.9.0/documentation/xivapi_swift/sheets/submarineexploration "xivapi-swift Documentation â€“ Swift Package Index"
[6]: https://v2.xivapi.com/docs/welcome/ "Welcome | xivapi"
[7]: https://ffxiv.consolegameswiki.com/wiki/Concealed_Bay?utm_source=chatgpt.com "Concealed Bay - Final Fantasy XIV Online Wiki"
[8]: https://ffxiv.gamerescape.com/wiki/Concealed_Bay?utm_source=chatgpt.com "Concealed Bay - Gamer Escape's Final Fantasy XIV ..."
[9]: https://eorzeaworld.com/en/freecompany?utm_source=chatgpt.com "Eorzea World: Free Company"
[10]: https://www.mogship.com/submarines/calculator?utm_source=chatgpt.com "Trip planner"
[11]: https://lumina.xiv.dev/docs/guides/excel.html?utm_source=chatgpt.com "Advanced Excel"
[12]: https://ffxiv.gamerescape.com/wiki/Category%3ASubaquatic_Deployment_Sector "Category:Subaquatic Deployment Sector - Gamer Escape's Final Fantasy XIV (FFXIV, FF14) wiki"
[13]: https://consolegameswiki.com/wiki/Category%3ASubaquatic_Deployment_Sector "Category:Subaquatic Deployment Sector - Final Fantasy XIV Online Wiki - FFXIV / FF14 Online Community Wiki and Guide"
[14]: https://v2.xivapi.com/docs/guides/concepts/ "Important Concepts | xivapi"
